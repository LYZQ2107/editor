name: Build and Deploy to Server

on:
    push:
        branches:
            - main  # ç›‘å¬ main åˆ†æ”¯çš„æ¨é€
    workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘å·¥ä½œæµ

jobs:
    build-and-deploy:
        runs-on: ubuntu-latest  # ä½¿ç”¨ Ubuntu ç¯å¢ƒè¿è¡Œå·¥ä½œæµ
        steps:
            - name: Checkout code ğŸ›ï¸
              uses: actions/checkout@v3  # æ£€å‡ºä»£ç 

            - name: Setup Node.js Environment ğŸ§°
              uses: actions/setup-node@v3  # è®¾ç½® Node.js ç¯å¢ƒ
              with:
                  node-version: '16'  # ä½¿ç”¨ Node.js 16.x
                  cache: 'npm'  # å¯ç”¨ npm ç¼“å­˜

            - name: Install dependencies and build ğŸ”§
              run: |
                  npm install  # å®‰è£…ä¾èµ–
                  npm run build  # æ„å»ºé¡¹ç›®

            - name: Deploy to Server ğŸš€
              uses: easingthemes/ssh-deploy@v2.1.5  # ä½¿ç”¨ SSH éƒ¨ç½²åˆ°æœåŠ¡å™¨
              with:
                  ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}  # ä» Secrets è·å– SSH ç§é’¥
                  remote-host: ${{ secrets.REMOTE_HOST }}  # æœåŠ¡å™¨ IP
                  remote-user: ${{ secrets.REMOTE_USER }}  # æœåŠ¡å™¨ç”¨æˆ·å
                  source-directory: ./dist  # æ„å»ºåçš„è¾“å‡ºç›®å½•ï¼ˆé»˜è®¤ä¸º ./distï¼‰
                  target-directory: /BridgeV2Buildup  # æœåŠ¡å™¨ä¸Šçš„ç›®æ ‡ç›®å½•
